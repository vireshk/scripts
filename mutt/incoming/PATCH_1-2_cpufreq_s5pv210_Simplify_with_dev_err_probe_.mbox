From vireshk  Thu Aug 27 09:29:36 2020
Delivered-To: viresh.kumar@linaro.org
Received: from pop.gmail.com [74.125.68.109] 	by vireshk-i7 with POP3 (fetchmail-6.3.26) 	for <vireshk@localhost> (single-drop); Thu, 27 Aug 2020 09:29:36 +0530 (IST)
Received: by 2002:a05:6602:1488:0:0:0:0 with SMTP id a8csp3988117iow;         Wed, 26 Aug 2020 09:00:23 -0700 (PDT)
X-Google-Smtp-Source: ABdhPJxiA2FkL8DNue1F18uV5OcdFcMV7jVGz7UCOpjQY8oXzGHAZDBQr9Kiax/M7oJCFetHZi2W
X-Received: by 2002:a63:475d:: with SMTP id w29mr10516736pgk.287.1598457623735;         Wed, 26 Aug 2020 09:00:23 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1598457623; cv=none;         d=google.com; s=arc-20160816;         b=rMjBMRJj9EGkwxT2C6bnnl9wNcaH6G0qrYuATdmNhwrZgK9MkS+3be+kv/mjEyqYBV          l9FQqzAKVKlwGDljwQCkQNqKYEr031IRpWPGzUzMIfQV2h1Ud7httlVtjsdl5FxCA4tc          5pe1InB1hq1X4cNxGupgoPRWrGPFROeBpoY5QU70pSZs3JCrjb7bJOYq2ta85q1RSFp/          TcWqBzi5AC9lt3GbCcQxfN3UPqsS5BEEwK1jZ141rT4YLPmtOHP6E2+CSvvwveTBeXvw          RWx4pnKG6epev2F7rr/GFBeHSXd49P4EdxshRJ2UJfF/IFFMDOlshIo72pmtJkvCD0hX          VQPA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;         h=message-id:date:subject:to:from:dkim-signature;         bh=a8iDQzuWhf+hscP7mvnnGx1HqyCHiVKNV9jx41i+4eE=;         b=t9C9opdTsHxiFAuKwcPJTJaJ76N2Jaovzg5uz5gp0ZzyvGY23h6vtIyM+VeNHWMLyR          rBS6DKwy2dDmR31ImTCk02y3t7aPwZ34iDUJ8o7P0br7uvaqLyxULE8YcAgyFXbiTlCn          7+vqjMY95yEyBorvG2WbjaJAyje/bJ0ErdfIPwMk5lpExPRnnmA0wQq/ShGPfzomnhsW          0dqhePd/ST76o39yALYIstETONuQ0HpIbAG/GxVkke61cwW9IYHeMoCLzRqWP3CXAi7r          u/NkEo6T8c+GjpNonAcFIbac//gORy3qvksLo1sqZIepuXBYTE336Cbdis8hfXLqQqyM          W84A==
ARC-Authentication-Results: i=1; mx.google.com;        dkim=pass header.i=@kernel.org header.s=default header.b=ProeJqdf;        spf=pass (google.com: domain of krzk@kernel.org designates 198.145.29.99 as permitted sender) smtp.mailfrom=krzk@kernel.org;        dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=kernel.org
Return-Path: <krzk@kernel.org>
Received: from mail.kernel.org (mail.kernel.org. [198.145.29.99])         by mx.google.com with ESMTPS id p9si2015430pjn.61.2020.08.26.09.00.23         for <viresh.kumar@linaro.org>         (version=TLS1_2 cipher=ECDHE-ECDSA-AES128-GCM-SHA256 bits=128/128);         Wed, 26 Aug 2020 09:00:23 -0700 (PDT)
Received-SPF: pass (google.com: domain of krzk@kernel.org designates 198.145.29.99 as permitted sender) client-ip=198.145.29.99;
Authentication-Results: mx.google.com;        dkim=pass header.i=@kernel.org header.s=default header.b=ProeJqdf;        spf=pass (google.com: domain of krzk@kernel.org designates 198.145.29.99 as permitted sender) smtp.mailfrom=krzk@kernel.org;        dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=kernel.org
Received: from localhost.localdomain (unknown [194.230.155.216]) 	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits)) 	(No client certificate requested) 	by mail.kernel.org (Postfix) with ESMTPSA id 841C92075E; 	Wed, 26 Aug 2020 16:00:21 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org; 	s=default; t=1598457623; 	bh=mqR6dbxEf9z3vf/e9zsd9vKuP/SWTci1RRRc7pR/mng=; 	h=From:To:Subject:Date:From; 	b=ProeJqdfv5Yw8CPijUlTSYb0EnUgcSzUyhpu2A6OQozvdgQbiLbd1Fv7Ci/g32HI1 	 p58z2hRxT22VlWtHVG+2HEsZOMCtGPc1qYsm2TNrTFwcUy7EIZl34RUz7LRpGWIclz 	 LKie1y3TgY7p3GgLm84hW37yvq5md3NEbNMWyFS4=
From: Krzysztof Kozlowski <krzk@kernel.org>
To: "Rafael J. Wysocki" <rjw@rjwysocki.net>, 	Viresh Kumar <viresh.kumar@linaro.org>, 	Kukjin Kim <kgene@kernel.org>, 	Krzysztof Kozlowski <krzk@kernel.org>, 	linux-pm@vger.kernel.org, 	linux-arm-kernel@lists.infradead.org, 	linux-samsung-soc@vger.kernel.org, 	linux-kernel@vger.kernel.org
Subject: [PATCH 1/2] cpufreq: s5pv210: Simplify with dev_err_probe()
Date: Wed, 26 Aug 2020 18:00:15 +0200
Message-Id: <20200826160016.469-1-krzk@kernel.org>
X-Mailer: git-send-email 2.17.1
Content-Length: 1681
Lines: 49

Common pattern of handling deferred probe can be simplified with
dev_err_probe().  Less code and also it prints the error value.

Signed-off-by: Krzysztof Kozlowski <krzk@kernel.org>
---
 drivers/cpufreq/s5pv210-cpufreq.c | 18 ++++++------------
 1 file changed, 6 insertions(+), 12 deletions(-)

diff --git a/drivers/cpufreq/s5pv210-cpufreq.c b/drivers/cpufreq/s5pv210-cpufreq.c
index e84281e2561d..7dccdb364fcf 100644
--- a/drivers/cpufreq/s5pv210-cpufreq.c
+++ b/drivers/cpufreq/s5pv210-cpufreq.c
@@ -590,6 +590,7 @@ static struct notifier_block s5pv210_cpufreq_reboot_notifier = {
 
 static int s5pv210_cpufreq_probe(struct platform_device *pdev)
 {
+	struct device *dev = &pdev->dev;
 	struct device_node *np;
 	int id, result = 0;
 
@@ -602,21 +603,14 @@ static int s5pv210_cpufreq_probe(struct platform_device *pdev)
 	 * cpufreq-dt driver.
 	 */
 	arm_regulator = regulator_get(NULL, "vddarm");
-	if (IS_ERR(arm_regulator)) {
-		if (PTR_ERR(arm_regulator) == -EPROBE_DEFER)
-			pr_debug("vddarm regulator not ready, defer\n");
-		else
-			pr_err("failed to get regulator vddarm\n");
-		return PTR_ERR(arm_regulator);
-	}
+	if (IS_ERR(arm_regulator))
+		return dev_err_probe(dev, PTR_ERR(arm_regulator),
+				     "failed to get regulator vddarm\n");
 
 	int_regulator = regulator_get(NULL, "vddint");
 	if (IS_ERR(int_regulator)) {
-		if (PTR_ERR(int_regulator) == -EPROBE_DEFER)
-			pr_debug("vddint regulator not ready, defer\n");
-		else
-			pr_err("failed to get regulator vddint\n");
-		result = PTR_ERR(int_regulator);
+		result = dev_err_probe(dev, PTR_ERR(int_regulator),
+				       "failed to get regulator vddint\n");
 		goto err_int_regulator;
 	}
 
-- 
2.17.1

