From vireshk  Tue Apr 23 09:29:48 2024
Delivered-To: viresh.kumar@linaro.org
Received: from pop.gmail.com [142.251.175.108] 	by vireshk-i7 with POP3 (fetchmail-6.4.2) 	for <vireshk@localhost> (single-drop); Tue, 23 Apr 2024 09:29:48 +0530 (IST)
Received: by 2002:a05:7208:9104:b0:82:b0d3:6408 with SMTP id a4csp2950920rbf;         Mon, 22 Apr 2024 19:07:42 -0700 (PDT)
X-Forwarded-Encrypted: i=2; AJvYcCUL6NlMlN31rFUsr2slQwX4fslM5exhI4EZMB1nmmdGX3I1uo89uiassHLPtrzmMLdp2mju187EWr5z+Ax8ZNMxiKcrUoVo1g==
X-Received: by 2002:a05:6e02:20cb:b0:36b:3a6e:ee83 with SMTP id 11-20020a056e0220cb00b0036b3a6eee83mr9006991ilq.22.1713838062679;         Mon, 22 Apr 2024 19:07:42 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1713838062; cv=none;         d=google.com; s=arc-20160816;         b=ccuDvT9aE0oNv0RlqjSpGPoFVdnsNXv8jSqnS+kZgDsoQnoeSAe3FPtxZlE4va6+VY          2fouylITaYo6HR0hlSSxggzUkrSzJTO8vrMNjdjFLKh46h9lHX3MAEUwFwcCfTT8eo6c          tFU6DrdnDOYdY/fDToZHEf+ettfJSdsEBk0yWx6dG4nauMd9gGQ8C/J+8OT42zOzIn3B          DcMli9RdjSzuDK3gDJ8ErAs5sIJrum1h1iiYPZGQvoGxnI+gJvRZn9oofN7GbT5TBpL5          WZEYUJhOQlkyLcBF7D7uizFEZ/GZstVIzfX7u13uhvEQCRgDJikVqzJEzBcNnyKu8WEQ          O37w==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;         h=content-transfer-encoding:mime-version:message-id:date:subject:cc          :to:from:dkim-signature;         bh=xYc9PG4AdLig2kL4uYy88kS70WFB66OiQXfEpWrHUaQ=;         fh=OGMFl9HFfWgic34CEfbXwBLghGwy4nyd+7afrdmQvgg=;         b=Cu4Tg6sv5lQT3w2gcSkmGsG13IB3HyjvQAzaUjIWbCCyAGZ78D6fdkvzN+WnLbGdnO          Iq5NJrdMHAdgAu0WXGHcQwQirgvOB+CEca4Hwxe/qW7p+z/N5ub5B2YQFykTfxJNdmlI          R98SYpNTlvnBVa1rsoWOOiWzaHhGs5cSi25OtV/ecs7wiDNjgKUzOQdy6fSAXFRKVr/g          ekf/RKYYY9Q/o4f2G3nh+N3k9SX9fC6S5MxY2tdizDre0Akee9CPvCezneHRdoMPKCX4          KJsMuei4jYRJ2/2AGhJfCmSUCJy8fy9R/sH2ShvdTbH68mOBKHEzFhqQf0ZDIO/xE+tV          v8yg==;         dara=google.com
ARC-Authentication-Results: i=1; mx.google.com;        dkim=pass header.i=@gmail.com header.s=20230601 header.b=asD++KXX;        spf=pass (google.com: domain of shivani07g@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=shivani07g@gmail.com;        dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
Return-Path: <shivani07g@gmail.com>
Received: from mail-sor-f41.google.com (mail-sor-f41.google.com. [209.85.220.41])         by mx.google.com with SMTPS id x14-20020a056e02194e00b0036b2ffa03d4sor7719475ilu.3.2024.04.22.19.07.42         for <viresh.kumar@linaro.org>         (Google Transport Security);         Mon, 22 Apr 2024 19:07:42 -0700 (PDT)
Received-SPF: pass (google.com: domain of shivani07g@gmail.com designates 209.85.220.41 as permitted sender) client-ip=209.85.220.41;
Authentication-Results: mx.google.com;        dkim=pass header.i=@gmail.com header.s=20230601 header.b=asD++KXX;        spf=pass (google.com: domain of shivani07g@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=shivani07g@gmail.com;        dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=gmail.com; s=20230601; t=1713838062; x=1714442862; darn=linaro.org;         h=content-transfer-encoding:mime-version:message-id:date:subject:cc          :to:from:from:to:cc:subject:date:message-id:reply-to;         bh=xYc9PG4AdLig2kL4uYy88kS70WFB66OiQXfEpWrHUaQ=;         b=asD++KXX9UhDg9pUxA3GbJN5oNuGLbHHgrNXyfnWbcsUejD5xP2OLBEPTUmsk+59Yn          j2OgDoe0PVbsKOSfBpXNhU9iykOJyPqB5ffSp4NpyhTACgE6ChGe6wzZbvZZEOPtTKiR          s0Firb8SQ9hcMnlzCocgVOrysLA87ndmah9rOgtr0LlBXCDjJw5wso3dxufeNCQClmn6          lf1RCks6wckOLB2RQSG9tIw2e4GGQ0/LHzXzwm6XCNFxMZ+RFz78w8nRj0TQ+uJTnAyq          GmJ9tn5YnKAMCZamuQNWodJFp9EMr/2PmuYXYwU41uczR4OPLT2bwqlffiiLyI3PmO2W          FwLg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=1e100.net; s=20230601; t=1713838062; x=1714442862;         h=content-transfer-encoding:mime-version:message-id:date:subject:cc          :to:from:x-gm-message-state:from:to:cc:subject:date:message-id          :reply-to;         bh=xYc9PG4AdLig2kL4uYy88kS70WFB66OiQXfEpWrHUaQ=;         b=DbJ1F/4clIMng7PRgCfWKwzp3frtGQ+6C09Lca5VLBGXOYG089jsOOc03TS7tjXo9A          AxwajhX9e1MDX7ySp2yCPCXOh8EpEr9yv2LCg7M4zSv12Eov+CyeR4SBBMX+blCLHs8e          jhQU/byJNxtiEbWCNuCKrjaOPMfPaKpuzw2JCjM6cXhaLEGbR0NXOXGZdAk+MKUXDuWp          VOTywJM3LS7ZDku8gG8ZQ+GOtRYrly0Kl0PYAUjfMAbjsEJhMoviblUseh35lfo2kkeo          6f3wCselB0ee3eZge4TvORune0PL7J5zNTesqFldaI98ImGXSgEfA9rd3zO/dU8NGkeX          gMGA==
X-Forwarded-Encrypted: i=1; AJvYcCWX9ai7xOjOr2GkcQ8kM8Cx9dAhNx7Ym9D0/BdEef0H8K/E8D1iRS4lgnOIac1ucPAHbvyhE4JnQTOlhtdJIzQi/2/kn0XyPg==
X-Gm-Message-State: AOJu0YzaT2zhjwXIMPBlXQCLvl621k8meQ/BRY8KVRYwwO+SB8PsSC3W 	FBJ3zz/aNKU16aHmcISxit3285xaezLClwVqnp7P+TvzEuDxLET3
X-Google-Smtp-Source: AGHT+IGwxh2OM9tX4e5d2qHncG5fuXlT/Z3UAlim+95OglEJdb4efqOND29R/rfjvdfePDaJsOcRog==
X-Received: by 2002:a05:6e02:1caf:b0:36b:fbae:3d01 with SMTP id x15-20020a056e021caf00b0036bfbae3d01mr16150033ill.17.1713838061852;         Mon, 22 Apr 2024 19:07:41 -0700 (PDT)
Return-Path: <shivani07g@gmail.com>
Received: from shiv-machina.. (c-73-169-52-138.hsd1.co.comcast.net. [73.169.52.138])         by smtp.gmail.com with ESMTPSA id v11-20020a056e0213cb00b003662d874215sm2426565ilj.6.2024.04.22.19.07.41         (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);         Mon, 22 Apr 2024 19:07:41 -0700 (PDT)
From: Shivani Gupta <shivani07g@gmail.com>
To: "Rafael J . Wysocki" <rafael@kernel.org>, 	Viresh Kumar <viresh.kumar@linaro.org>
Cc: linux-pm@vger.kernel.org, 	linux-kernel@vger.kernel.org, 	skhan@linuxfoundation.org, 	javier.carrasco.cruz@gmail.com, 	Shivani Gupta <shivani07g@gmail.com>, 	Julia Lawall <julia.lawall@inria.fr>
Subject: [PATCH] cpufreq: ti: Implement scope-based cleanup in ti_cpufreq_match_node()
Date: Tue, 23 Apr 2024 02:07:27 +0000
Message-Id: <20240423020727.776360-1-shivani07g@gmail.com>
X-Mailer: git-send-email 2.34.1
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Content-Length: 1227
Lines: 35

This patch modifies the ti_cpufreq_match_node() function to utilize the
__free() cleanup handler for automatically releasing the device
node when it goes out of scope.

By moving the declaration to the initialization, the patch ensures that
the device node is properly managed throughout the function's scope,
thus eliminating the need for manual invocation of of_node_put().
This approach reduces the potential for memory leaks.

Suggested-by: Julia Lawall <julia.lawall@inria.fr>
Signed-off-by: Shivani Gupta <shivani07g@gmail.com>
---
 drivers/cpufreq/ti-cpufreq.c | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/drivers/cpufreq/ti-cpufreq.c b/drivers/cpufreq/ti-cpufreq.c
index 46c41e2ca727..714ed53753fa 100644
--- a/drivers/cpufreq/ti-cpufreq.c
+++ b/drivers/cpufreq/ti-cpufreq.c
@@ -347,12 +347,10 @@ static const struct of_device_id ti_cpufreq_of_match[] = {

 static const struct of_device_id *ti_cpufreq_match_node(void)
 {
-	struct device_node *np;
+	struct device_node *np __free(device_node) = of_find_node_by_path("/");
 	const struct of_device_id *match;

-	np = of_find_node_by_path("/");
 	match = of_match_node(ti_cpufreq_of_match, np);
-	of_node_put(np);

 	return match;
 }
--
2.34.1

