From vireshk  Thu Jul 25 16:13:46 2019
Delivered-To: viresh.kumar@linaro.org
Received: from gmail-pop.l.google.com [74.125.200.109] 	by vireshk-i7 with POP3 (fetchmail-6.3.26) 	for <vireshk@localhost> (single-drop); Thu, 25 Jul 2019 16:13:46 +0530 (IST)
Received: by 2002:a02:1a89:0:0:0:0:0 with SMTP id 131csp8301740jai;         Thu, 25 Jul 2019 03:42:33 -0700 (PDT)
X-Google-Smtp-Source: APXvYqz73LcqWKIYZ3jSZNVVRVTEY+cO8dNwvHahPz1twbmz+5weSpvdnvd2FE1a8mqGWrjCUVWJ
X-Received: by 2002:a62:be02:: with SMTP id l2mr16366951pff.63.1564051353648;         Thu, 25 Jul 2019 03:42:33 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1564051353; cv=none;         d=google.com; s=arc-20160816;         b=v506jv/6B6/YkbBY4Yb+7WfUzL0ZZmXNs8NWkagR/vNPL+B7cY/7UEkOBs3AD6sn3d          T2mfljtHodU5faOJeydc69r2cour/z9AzYQ99cA6b/3DuCOKwOCYQCdQAbz0VUnjPSLQ          X0477Z6Ng0E/oOFlilpF87QVWqpdmCavnqw4Yj01U8dhIaSzVwP8YsYjGEyTIIjjt/rd          BKsWQm70S9wOC7EvQbQHaKD446VrhhnR2EqW4yvyqtSBVW4SeNBcYP5OurWLr8Ie25uj          fI1Cs3lbWBKe+J3d79/ExwYE6Y7US9Vh5iDhOGFlHnNzyMuF8Ch0gYlEqVcjNgwawXZm          HZ8A==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;         h=content-transfer-encoding:mime-version:references:in-reply-to          :message-id:date:subject:cc:to:from:dkim-signature:dmarc-filter          :delivered-to;         bh=3GNalLtrTqW5s+BFJJMMFnFc3aO7NBuze3htvzi00W0=;         b=KcDqCvXMfwtVstXOczaux5YhfJNM7uVqqXK1+AV69rGupV9LMxauucnXIsZeQlYPUe          dOuN7SCefmYqryWWgp+Rg2ILYDT1JtyqtLIadUBFd15u4f7nSIuXEhN+PRdrdPoNcspK          +0UFMAHKwIrznkmR5omMIXFOvSrjH4m5RqPnEp0zDi57e2iiUaJ6abjJE9PvOkXDvuqE          i/ELk8Y0FCPHPx2zXmSF8/y/T75hOM2IwsO3mJh295a8AML4ea7TaGdtRltT3ERA62/a          YIwhGao3c/watAFmLNxMj1EDd0ZAjVJ6dv5J4R6IlgWl/2KCMgfAGARj8MnL8m7gw9QR          dZJg==
ARC-Authentication-Results: i=1; mx.google.com;        dkim=pass header.i=@linaro.org header.s=google header.b=csVHpCLA;        spf=pass (google.com: domain of srs0=wdvt=vw=linaro.org=niklas.cassel@kernel.org designates 198.145.29.99 as permitted sender) smtp.mailfrom="SRS0=wdVt=VW=linaro.org=niklas.cassel@kernel.org";        dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=linaro.org
Return-Path: <SRS0=wdVt=VW=linaro.org=niklas.cassel@kernel.org>
Received: from mail.kernel.org (mail.kernel.org. [198.145.29.99])         by mx.google.com with ESMTPS id z191si16707416pgd.572.2019.07.25.03.42.33         for <viresh.kumar@linaro.org>         (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);         Thu, 25 Jul 2019 03:42:33 -0700 (PDT)
Received-SPF: pass (google.com: domain of srs0=wdvt=vw=linaro.org=niklas.cassel@kernel.org designates 198.145.29.99 as permitted sender) client-ip=198.145.29.99;
Authentication-Results: mx.google.com;        dkim=pass header.i=@linaro.org header.s=google header.b=csVHpCLA;        spf=pass (google.com: domain of srs0=wdvt=vw=linaro.org=niklas.cassel@kernel.org designates 198.145.29.99 as permitted sender) smtp.mailfrom="SRS0=wdVt=VW=linaro.org=niklas.cassel@kernel.org";        dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=linaro.org
Received: by mail.kernel.org (Postfix) 	id 6DFC922CD5; Thu, 25 Jul 2019 10:42:33 +0000 (UTC)
Delivered-To: vireshk@kernel.org
Received: from mail-lj1-f194.google.com (mail-lj1-f194.google.com [209.85.208.194]) 	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits)) 	(No client certificate requested) 	by mail.kernel.org (Postfix) with ESMTPS id 17B1122CBE 	for <vireshk@kernel.org>; Thu, 25 Jul 2019 10:42:32 +0000 (UTC)
Authentication-Results: mail.kernel.org; 	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="csVHpCLA"
DMARC-Filter: OpenDMARC Filter v1.3.2 mail.kernel.org 17B1122CBE
Authentication-Results: mail.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: mail.kernel.org; spf=pass smtp.mailfrom=niklas.cassel@linaro.org
Received: by mail-lj1-f194.google.com with SMTP id z28so47602336ljn.4         for <vireshk@kernel.org>; Thu, 25 Jul 2019 03:42:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=linaro.org; s=google;         h=from:to:cc:subject:date:message-id:in-reply-to:references          :mime-version:content-transfer-encoding;         bh=3GNalLtrTqW5s+BFJJMMFnFc3aO7NBuze3htvzi00W0=;         b=csVHpCLA5Pk3GDmRAP9m1Ka9VSO+6NzJzZMzdJorVAdGE3hwGdBVrpgI7dNWlxKh5+          gp2Jnqh1jTzEYKZ2cuAO9fNIysTEyilMqkvBZ7Es/sttkX11gsh4pt17Bq5V5ikLgcPZ          07h4eMoW6kC1kiC/JWESg9NsKm9MS3EWFMcEDENNY4HnbldWLbbmD0U/xtAOPCaINXcP          lwBrhC+T1897IM+jvEohanzwbCHC/BLsmnRGCTZu41aQcIjP8uexSxkp2ORA4s2orTNl          d0Daf2zOXzOT9wsg3Vk0S0kKM6dwDOTBAegabpvisdrX3oBYB2iPQrG5HICwn2pT+Pt0          Cx0Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=1e100.net; s=20161025;         h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to          :references:mime-version:content-transfer-encoding;         bh=3GNalLtrTqW5s+BFJJMMFnFc3aO7NBuze3htvzi00W0=;         b=mPdLG5XXYsNqo4AvyyvB2pgKAOQJZOkI7eG0AtaBzMvHywAPXQn1ZhqKfY8urFOnPB          7AjHCc0pkjN2TaqTOMelz1fs695l3mlQBu6h3dKdkg8jzfOW94QRhaG+2myAqkoyEgXk          Ch4CAnKicQHk+jSoSd3l73HiKR4T/B7Jr8Z3S8MhLL0tVnvG0rUb2UK6ysHks2cqGwwK          T+LD8+iTeLnTI0Lp1hoUrqdxUu/GOFqzHfqZXSGqN2fkrA+YmSPoBIIbQle87JKHO9lx          ZZ9VPCNAbqC/GbsBFmmEYGr+axfeDPg5diYFqhrygmWDPJBn/yIKIt4O+9DAfD7ioBtP          9uCQ==
X-Gm-Message-State: APjAAAX1JkUsaqggWaw2GerEbPptFN4Omsqa6ghuDKy/EJfMLezPjU84 	JIPWBUTnF/OYAubCBEVKtgYLxQ==
X-Received: by 2002:a2e:8849:: with SMTP id z9mr6421628ljj.203.1564051351281;         Thu, 25 Jul 2019 03:42:31 -0700 (PDT)
Received: from localhost.localdomain (ua-83-226-44-230.bbcust.telenor.se. [83.226.44.230])         by smtp.gmail.com with ESMTPSA id k124sm7461299lfd.60.2019.07.25.03.42.30         (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);         Thu, 25 Jul 2019 03:42:30 -0700 (PDT)
From: Niklas Cassel <niklas.cassel@linaro.org>
To: Andy Gross <agross@kernel.org>, 	Ilia Lin <ilia.lin@kernel.org>, 	Viresh Kumar <vireshk@kernel.org>, 	Nishanth Menon <nm@ti.com>, 	Stephen Boyd <sboyd@kernel.org>
Cc: linux-arm-msm@vger.kernel.org, 	jorge.ramirez-ortiz@linaro.org, 	bjorn.andersson@linaro.org, 	ulf.hansson@linaro.org, 	Niklas Cassel <niklas.cassel@linaro.org>, 	Rob Herring <robh+dt@kernel.org>, 	Mark Rutland <mark.rutland@arm.com>, 	linux-pm@vger.kernel.org, 	devicetree@vger.kernel.org, 	linux-kernel@vger.kernel.org
Subject: [PATCH v2 06/14] dt-bindings: cpufreq: qcom-nvmem: Support pstates provided by a power domain
Date: Thu, 25 Jul 2019 12:41:34 +0200
Message-Id: <20190725104144.22924-7-niklas.cassel@linaro.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190725104144.22924-1-niklas.cassel@linaro.org>
References: <20190725104144.22924-1-niklas.cassel@linaro.org>
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Content-Length: 3413
Lines: 139

Some Qualcomm SoCs have support for Core Power Reduction (CPR).
On these platforms, we need to attach to the power domain provider
providing the performance states, so that the leaky device (the CPU)
can configure the performance states (which represent different
CPU clock frequencies).

Signed-off-by: Niklas Cassel <niklas.cassel@linaro.org>
---
 .../bindings/opp/qcom-nvmem-cpufreq.txt       | 111 ++++++++++++++++++
 1 file changed, 111 insertions(+)

diff --git a/Documentation/devicetree/bindings/opp/qcom-nvmem-cpufreq.txt b/Documentation/devicetree/bindings/opp/qcom-nvmem-cpufreq.txt
index c5ea8b90e35d..e19a95318e98 100644
--- a/Documentation/devicetree/bindings/opp/qcom-nvmem-cpufreq.txt
+++ b/Documentation/devicetree/bindings/opp/qcom-nvmem-cpufreq.txt
@@ -23,6 +23,15 @@ In 'operating-points-v2' table:
 
 Optional properties:
 --------------------
+In 'cpus' nodes:
+- power-domains: A phandle pointing to the PM domain specifier which provides
+		the performance states available for active state management.
+		Please refer to the power-domains bindings
+		Documentation/devicetree/bindings/power/power_domain.txt
+		and also examples below.
+- power-domain-names: Should be
+	- 'cpr' for qcs404.
+
 In 'operating-points-v2' table:
 - nvmem-cells: A phandle pointing to a nvmem-cells node representing the
 		efuse registers that has information about the
@@ -682,3 +691,105 @@ soc {
 		};
 	};
 };
+
+Example 2:
+---------
+
+	cpus {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		CPU0: cpu@100 {
+			device_type = "cpu";
+			compatible = "arm,cortex-a53";
+			reg = <0x100>;
+			....
+			clocks = <&apcs_glb>;
+			operating-points-v2 = <&cpu_opp_table>;
+			power-domains = <&cprpd>;
+			power-domain-names = "cpr";
+		};
+
+		CPU1: cpu@101 {
+			device_type = "cpu";
+			compatible = "arm,cortex-a53";
+			reg = <0x101>;
+			....
+			clocks = <&apcs_glb>;
+			operating-points-v2 = <&cpu_opp_table>;
+			power-domains = <&cprpd>;
+			power-domain-names = "cpr";
+		};
+
+		CPU2: cpu@102 {
+			device_type = "cpu";
+			compatible = "arm,cortex-a53";
+			reg = <0x102>;
+			....
+			clocks = <&apcs_glb>;
+			operating-points-v2 = <&cpu_opp_table>;
+			power-domains = <&cprpd>;
+			power-domain-names = "cpr";
+		};
+
+		CPU3: cpu@103 {
+			device_type = "cpu";
+			compatible = "arm,cortex-a53";
+			reg = <0x103>;
+			....
+			clocks = <&apcs_glb>;
+			operating-points-v2 = <&cpu_opp_table>;
+			power-domains = <&cprpd>;
+			power-domain-names = "cpr";
+		};
+	};
+
+	cpu_opp_table: cpu-opp-table {
+		compatible = "operating-points-v2-kryo-cpu";
+		opp-shared;
+
+		opp-1094400000 {
+			opp-hz = /bits/ 64 <1094400000>;
+			required-opps = <&cpr_opp1>;
+		};
+		opp-1248000000 {
+			opp-hz = /bits/ 64 <1248000000>;
+			required-opps = <&cpr_opp2>;
+		};
+		opp-1401600000 {
+			opp-hz = /bits/ 64 <1401600000>;
+			required-opps = <&cpr_opp3>;
+		};
+	};
+
+	cpr_opp_table: cpr-opp-table {
+		compatible = "operating-points-v2-qcom-level";
+
+		cpr_opp1: opp1 {
+			opp-level = <1>;
+			....
+		};
+		cpr_opp2: opp2 {
+			opp-level = <2>;
+			....
+		};
+		cpr_opp3: opp3 {
+			opp-level = <3>;
+			....
+		};
+	};
+
+....
+
+soc {
+....
+	cprpd: cpr@b018000 {
+		compatible = "qcom,qcs404-cpr", "qcom,cpr";
+		reg = <0x0b018000 0x1000>;
+		....
+		vdd-apc-supply = <&pms405_s3>;
+		#power-domain-cells = <0>;
+		operating-points-v2 = <&cpr_opp_table>;
+		....
+	};
+};
-- 
2.21.0

