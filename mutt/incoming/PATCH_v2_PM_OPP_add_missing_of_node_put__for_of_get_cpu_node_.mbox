From vireshk  Wed Oct 11 15:42:01 2017
Delivered-To: viresh.kumar@linaro.org
Received: from gmail-pop.l.google.com [74.125.200.109] 	by vireshk-i7 with POP3 (fetchmail-6.3.26) 	for <vireshk@localhost> (single-drop); Wed, 11 Oct 2017 15:42:01 +0530 (IST)
Received: by 10.2.51.94 with SMTP id k30csp519508jak;         Wed, 11 Oct 2017 03:11:13 -0700 (PDT)
X-Google-Smtp-Source: AOwi7QCVMRXpvAeJrQcz/ot7Rq+sOX9jT7+iG7pqgcosUhJZRLYr/TblrbmJ73A4RvEmNLfTuRMz
X-Received: by 10.202.117.148 with SMTP id q142mr8845077oic.26.1507716673726;         Wed, 11 Oct 2017 03:11:13 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1507716673; cv=none;         d=google.com; s=arc-20160816;         b=QfbSnUJ44piL0cYWSnFLPsC2dqMHkIQzE740xpV64II7ExUi+Q+PVLc4oyOW1lZl0X          DxR9y2yUlbRfbFDzZLHxnSdWaC/UnA0g4ylVpcgRiO+/GXo7XBDqZt7hpaccMS5bqbBv          8oErlgRo2rTfh7qR3+jRlKnRqgx6QIOIwgVhb7VL2W6Ia6h4MWmCHt2Im0FRvNaZKaW7          rt9LsBAHoe2xXTZ06wtXH2DrlRLOmrfE+WPBq3OZioCJoH1siYTYJEBsWXWf+sHfYJ84          OK6yhuQwwIzituZgk0/lGU16gdahYA8I0bkL0RyqHROoa+zSP+V3i7M8EyWzAR1kEAWO          2lcA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;         h=references:in-reply-to:message-id:date:subject:cc:to:from          :arc-authentication-results;         bh=8Lm8s5W8iuaHkKHLF8pSEG2CuzphK2T2CcLTaXVUnJE=;         b=CMjdlWgrz748cm4DeuHeDcS0OtF8EtuE2nz2B9K+loEYnQArVZ2xVoTP2q/w8hoICV          ZN/Z6JJwB11kZe8060VkWXYgYPt1hLrElaiVUVn4FjgrdE3ucvUlcEpxUub+xGTnTbHI          tp0YET27J5ASqkAV4VqfeDtx1dZHfPJTZcHy56/nzKXcfdoMuMbKQrkZDzK5/NLSBosl          MbPl++AYWKEPQTW1bNbg0DJWoiEhdNs1AJSfXQ/l+ikAnD+Es5DjSDDmp4evDY+gxdtg          8yJMnc9zHFW5tHrFuK4zaRKO+UZ1M74OxmHEDealcaghszdWOJjbRiiKV7JaMMNunpRK          9U7A==
ARC-Authentication-Results: i=1; mx.google.com;        spf=pass (google.com: domain of sudeep.holla@arm.com designates 217.140.101.70 as permitted sender) smtp.mailfrom=sudeep.holla@arm.com
Return-Path: <sudeep.holla@arm.com>
Received: from foss.arm.com (usa-sjc-mx-foss1.foss.arm.com. [217.140.101.70])         by mx.google.com with ESMTP id e65si5617296oig.311.2017.10.11.03.11.13         for <viresh.kumar@linaro.org>;         Wed, 11 Oct 2017 03:11:13 -0700 (PDT)
Received-SPF: pass (google.com: domain of sudeep.holla@arm.com designates 217.140.101.70 as permitted sender) client-ip=217.140.101.70;
Authentication-Results: mx.google.com;        spf=pass (google.com: domain of sudeep.holla@arm.com designates 217.140.101.70 as permitted sender) smtp.mailfrom=sudeep.holla@arm.com
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.72.51.249]) 	by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 3C498F; 	Wed, 11 Oct 2017 03:11:13 -0700 (PDT)
Received: from e107155-lin.cambridge.arm.com (e107155-lin.cambridge.arm.com [10.1.210.28]) 	by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPA id DA2553F3E1; 	Wed, 11 Oct 2017 03:11:11 -0700 (PDT)
From: Sudeep Holla <sudeep.holla@arm.com>
To: Viresh Kumar <viresh.kumar@linaro.org>, 	linux-pm@vger.kernel.org
Cc: Sudeep Holla <sudeep.holla@arm.com>, 	Viresh Kumar <vireshk@kernel.org>, 	Nishanth Menon <nm@ti.com>, 	Stephen Boyd <sboyd@codeaurora.org>, 	"Rafael J. Wysocki" <rjw@rjwysocki.net>
Subject: [PATCH v2] PM / OPP: add missing of_node_put() for of_get_cpu_node()
Date: Wed, 11 Oct 2017 11:11:01 +0100
Message-Id: <1507716661-27146-1-git-send-email-sudeep.holla@arm.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1507632519-19648-1-git-send-email-sudeep.holla@arm.com>
References: <1507632519-19648-1-git-send-email-sudeep.holla@arm.com>

Commit 762792913f8c ("PM / OPP: Fix get sharing CPUs when hotplug is used")
moved away from using cpu_dev->of_node because of some limitations.
However commit 7467c9d95989 ("of: return of_get_cpu_node from
of_cpu_device_node_get if CPUs are not registered") added support to
falls back to of_get_cpu_node if called if CPUs are not registered yet.

It adds the missing of_node_put for the CPU device nodes. This patch also
moves back to use of_cpu_device_node_get in dev_pm_opp_of_get_sharing_cpus
to avoid scanning the device tree again.

