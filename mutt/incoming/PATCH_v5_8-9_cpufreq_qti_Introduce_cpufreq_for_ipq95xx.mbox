From vireshk  Fri Oct 20 11:53:13 2023
Delivered-To: viresh.kumar@linaro.org
Received: from pop.gmail.com [142.251.175.108] 	by vireshk-i7 with POP3 (fetchmail-6.4.2) 	for <vireshk@localhost> (single-drop); Fri, 20 Oct 2023 11:53:13 +0530 (IST)
Received: by 2002:a05:7208:d415:b0:76:e763:5a60 with SMTP id by21csp782281rbb;         Thu, 19 Oct 2023 23:21:16 -0700 (PDT)
X-Google-Smtp-Source: AGHT+IFk3GOffWJg3yqPcllfX0CmFcERGfL789YyUDD6Tt9Z5x99auT7nLakdR1kuwHjRpZgLcqd
X-Received: by 2002:a0d:cc44:0:b0:5a7:c49e:3f5c with SMTP id o65-20020a0dcc44000000b005a7c49e3f5cmr1091141ywd.21.1697782875989;         Thu, 19 Oct 2023 23:21:15 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1697782875; cv=none;         d=google.com; s=arc-20160816;         b=UcRE6YbeDubddoc/f0Wr8o1TYdG0xaItBN5U4G28Tti+CkAAvlwIM8rrJ//GgTd6nV          tSgd/6b5/lUJlZFv88+WPn5X6k9geujNFIHbT5Vo566mtpe7247dkMXBInjD4s3HEBn3          PiAdE8GSw6eSOzWaw9Ukkvu0sW4WDpmy0bS7BMI9AHG2ZoZPWDgN53sl8oYXdMmTpCcp          xaSTEGkORgNXcXrALJ8q1hZLRThPYUkDO7s8d1RxSNti5/zxUg3z8LH1DZGswVEUnZFj          TJI6sbjfM3R5mrzXTDbSnHcsXbFqpKdlsGy4RGZ6HfNtXYzxMMIVxRhlG3IpPMAewo52          66HA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;         h=mime-version:references:in-reply-to:message-id:date:subject:cc:to          :from:dkim-signature;         bh=LlQk6ncC8payQgiMOyKB8jXlWeLRdLG3WINON416hHk=;         fh=I1BoAR+h7S6+N5oVQGrbzeJSPQAaebNHNMUQ6jDz8qQ=;         b=dtp0bU7vTu91sHAOdoqNTpBAlGnjD6uKpBk9b4JBSgCO60VKwoRNpl50xO0loX+DeP          mC7b+WU9XzgrO5foFbtHia/epLlcWy4eCVyoOTUyWR38CmxM8GdCGgTor8sQwXrMHqGz          a+NAg2kJJvdWVprdiX3Nz4PAaYWkFZg8GrkoGnH/otRjtpylD+WM3v7JuJJ4AACQthnX          iS9nr8sCKgrwlFZHkLE985deNbWtRMUvjulQvP5R+x6gWqUm0HowapxDbd7elllNML9K          GmoOywCcn0FV4VFR4Dfz5uSf6LhbLnEjDnztOwX7qNYr14HrEuffNrg93bP13It1sjzt          f2xg==
ARC-Authentication-Results: i=1; mx.google.com;        dkim=pass header.i=@quicinc.com header.s=qcppdkim1 header.b=Oe2+dXCE;        spf=pass (google.com: domain of quic_varada@quicinc.com designates 205.220.180.131 as permitted sender) smtp.mailfrom=quic_varada@quicinc.com;        dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=quicinc.com
Return-Path: <quic_varada@quicinc.com>
Received: from mx0b-0031df01.pphosted.com (mx0b-0031df01.pphosted.com. [205.220.180.131])         by mx.google.com with ESMTPS id u11-20020a81a50b000000b0059b3e22e6d2si579260ywg.154.2023.10.19.23.21.15         (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);         Thu, 19 Oct 2023 23:21:15 -0700 (PDT)
Received-SPF: pass (google.com: domain of quic_varada@quicinc.com designates 205.220.180.131 as permitted sender) client-ip=205.220.180.131;
Authentication-Results: mx.google.com;        dkim=pass header.i=@quicinc.com header.s=qcppdkim1 header.b=Oe2+dXCE;        spf=pass (google.com: domain of quic_varada@quicinc.com designates 205.220.180.131 as permitted sender) smtp.mailfrom=quic_varada@quicinc.com;        dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=quicinc.com
Received: from pps.filterd (m0279869.ppops.net [127.0.0.1]) 	by mx0a-0031df01.pphosted.com (8.17.1.19/8.17.1.19) with ESMTP id 39K52wRM012498; 	Fri, 20 Oct 2023 06:20:42 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=quicinc.com; h=from : to : cc :  subject : date : message-id : in-reply-to : references : mime-version :  content-type; s=qcppdkim1;  bh=LlQk6ncC8payQgiMOyKB8jXlWeLRdLG3WINON416hHk=;  b=Oe2+dXCEJt/NWFeolk5wF0OfntDbkQNC1Wx7XlHQ4oYXM5l7iM9fI2mCkXHascuHA0v9  MkqHykVUu+jMqJPRMHgKxZDxL8YnNO1p/tCqtSSE9vqYA0RDyawC+0OC6DpHyW0QWIwZ  og945VPbBc3F/ZI0JbSJlQuwuHgujn9MH7HqWV53Kq4aQ5viSqV9wkps5iGAtftUDsFO  Q6qQy9O+9YN/OM4AnMer7FZ0249ksetNqQ6M6CSEj5uhAr/dwjsXkBJphp95Qao2kIZz  CBn5KyzogwvZzgpw34DR8s/gbmelH+GnMKqw3y0Yi9Um79rM16EFpxo+IHLMfDSk1LMt +w== 
Received: from nasanppmta03.qualcomm.com (i-global254.qualcomm.com [199.106.103.254]) 	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 3tubxggub7-1 	(version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT); 	Fri, 20 Oct 2023 06:20:42 +0000
Received: from nasanex01b.na.qualcomm.com (nasanex01b.na.qualcomm.com [10.46.141.250]) 	by NASANPPMTA03.qualcomm.com (8.17.1.5/8.17.1.5) with ESMTPS id 39K6Kfbw007956 	(version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT); 	Fri, 20 Oct 2023 06:20:41 GMT
Received: from varda-linux.qualcomm.com (10.80.80.8) by  nasanex01b.na.qualcomm.com (10.46.141.250) with Microsoft SMTP Server  (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id  15.2.1118.39; Thu, 19 Oct 2023 23:20:35 -0700
From: Varadarajan Narayanan <quic_varada@quicinc.com>
To: <agross@kernel.org>, <andersson@kernel.org>, <konrad.dybcio@linaro.org>,         <robh+dt@kernel.org>, <krzysztof.kozlowski+dt@linaro.org>,         <conor+dt@kernel.org>, <mturquette@baylibre.com>, <sboyd@kernel.org>,         <rafael@kernel.org>, <viresh.kumar@linaro.org>, <ilia.lin@kernel.org>,         <sivaprak@codeaurora.org>, <quic_kathirav@quicinc.com>,         <linux-arm-msm@vger.kernel.org>, <devicetree@vger.kernel.org>,         <linux-kernel@vger.kernel.org>, <linux-clk@vger.kernel.org>,         <linux-pm@vger.kernel.org>
CC: Varadarajan Narayanan <quic_varada@quicinc.com>,         Praveenkumar I 	<ipkumar@codeaurora.org>
Subject: [PATCH v5 8/9] cpufreq: qti: Introduce cpufreq for ipq95xx
Date: Fri, 20 Oct 2023 11:49:38 +0530
Message-ID: <4c8c2c2684f3824742bc2c6db7d10fa504616a33.1697781921.git.quic_varada@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <cover.1697781921.git.quic_varada@quicinc.com>
References: <cover.1697781921.git.quic_varada@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain
X-Originating-IP: [10.80.80.8]
X-ClientProxiedBy: nasanex01a.na.qualcomm.com (10.52.223.231) To  nasanex01b.na.qualcomm.com (10.46.141.250)
X-QCInternal: smtphost
X-Proofpoint-Virus-Version: vendor=nai engine=6200 definitions=5800 signatures=585085
X-Proofpoint-GUID: TxbS8vwUQ6XRGiEdo-025PkDeUFwJ_4t
X-Proofpoint-ORIG-GUID: TxbS8vwUQ6XRGiEdo-025PkDeUFwJ_4t
X-Proofpoint-Virus-Version: vendor=baseguard  engine=ICAP:2.0.272,Aquarius:18.0.980,Hydra:6.0.619,FMLib:17.11.176.26  definitions=2023-10-20_04,2023-10-19_01,2023-05-22_02
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0 malwarescore=0 suspectscore=0  bulkscore=0 lowpriorityscore=0 phishscore=0 spamscore=0 priorityscore=1501  mlxscore=0 impostorscore=0 mlxlogscore=999 adultscore=0 clxscore=1015  classifier=spam adjust=0 reason=mlx scancount=1 engine=8.12.0-2310170001  definitions=main-2310200053
Status: RO
Content-Length: 2455
Lines: 59

IPQ95xx SoCs have different OPPs available for the CPU based on
the SoC variant. This can be determined from an eFuse register
present in the silicon.

Added support for ipq95xx on nvmem driver which helps to
determine OPPs at runtime based on the eFuse register which
has the CPU frequency limits. opp-supported-hw dt binding
can be used to indicate the available OPPs for each limit.

Reviewed-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>
Signed-off-by: Praveenkumar I <ipkumar@codeaurora.org>
Signed-off-by: Kathiravan T <quic_kathirav@quicinc.com>
Signed-off-by: Varadarajan Narayanan <quic_varada@quicinc.com>
---
v5:	Merge IPQ95xx with APQ8096 case
v2:	Simplify bin selection by tweaking the order in dts
---
 drivers/cpufreq/cpufreq-dt-platdev.c | 1 +
 drivers/cpufreq/qcom-cpufreq-nvmem.c | 6 ++++++
 2 files changed, 7 insertions(+)

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index f43e5cd..4f794ba 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -183,6 +183,7 @@ static const struct of_device_id blocklist[] __initconst = {
 	{ .compatible = "qcom,ipq5332", },
 	{ .compatible = "qcom,ipq8064", },
 	{ .compatible = "qcom,ipq8074", },
+	{ .compatible = "qcom,ipq9574", },
 	{ .compatible = "qcom,apq8064", },
 	{ .compatible = "qcom,msm8974", },
 	{ .compatible = "qcom,msm8960", },
diff --git a/drivers/cpufreq/qcom-cpufreq-nvmem.c b/drivers/cpufreq/qcom-cpufreq-nvmem.c
index e7e6a6a..5827005 100644
--- a/drivers/cpufreq/qcom-cpufreq-nvmem.c
+++ b/drivers/cpufreq/qcom-cpufreq-nvmem.c
@@ -158,6 +158,11 @@ static int qcom_cpufreq_kryo_name_version(struct device *cpu_dev,
 	case QCOM_ID_IPQ5312:
 	case QCOM_ID_IPQ5302:
 	case QCOM_ID_IPQ5300:
+	case QCOM_ID_IPQ9514:
+	case QCOM_ID_IPQ9550:
+	case QCOM_ID_IPQ9554:
+	case QCOM_ID_IPQ9570:
+	case QCOM_ID_IPQ9574:
 		drv->versions = 1 << (unsigned int)(*speedbin);
 		break;
 	case QCOM_ID_MSM8996SG:
@@ -415,6 +420,7 @@ static const struct of_device_id qcom_cpufreq_match_list[] __initconst = {
 	{ .compatible = "qcom,ipq8064", .data = &match_data_krait },
 	{ .compatible = "qcom,ipq8074", .data = &match_data_ipq8074 },
 	{ .compatible = "qcom,apq8064", .data = &match_data_krait },
+	{ .compatible = "qcom,ipq9574", .data = &match_data_kryo },
 	{ .compatible = "qcom,msm8974", .data = &match_data_krait },
 	{ .compatible = "qcom,msm8960", .data = &match_data_krait },
 	{},
-- 
2.7.4

