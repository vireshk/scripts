From vireshk  Wed Jun 12 21:59:22 2019
Delivered-To: viresh.kumar@linaro.org
Received: from gmail-pop.l.google.com [74.125.24.109] 	by vireshk-i7 with POP3 (fetchmail-6.3.26) 	for <vireshk@localhost> (single-drop); Wed, 12 Jun 2019 21:59:22 +0530 (IST)
Received: by 2002:a02:1a89:0:0:0:0:0 with SMTP id 131csp6496247jai;         Wed, 12 Jun 2019 09:28:34 -0700 (PDT)
X-Google-Smtp-Source: APXvYqx5ZzgpKUxYiNR9FexzwfX2Ud28N92krdW2iOSrSoc7RrcLawakRjwHdfnvTGIGb+0sOolF
X-Received: by 2002:a65:60d9:: with SMTP id r25mr25822648pgv.228.1560356914100;         Wed, 12 Jun 2019 09:28:34 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1560356914; cv=none;         d=google.com; s=arc-20160816;         b=Uc8wdQn8/7965NdbI7CeQp4pOgSd92VhLPJayKTwtb7m/3eFs1gxtKwOERYD53RKJk          82KmsH2i2CPaxiCk4SBB3HX1Ezyf4IMyYj7wGLW/v2SAeTbuyI1Ob5z7rasTfJ/TDwTe          0FhKKFBVYiBJsmVZGGNB3xSKfRGIj4a8IvvCM/h0gUgrKqfW1YXtdMC7CbtKfGO56rtY          KUpxKnICw922MgwQqXIRA7pC/muA9wGeFvyjrHPQU/Vadgd0YV+Pne3ZLSVOMqUy8Vw8          pwHpVp4CsMfnhVxgVsl1mQyUICcFA9hGqI44tBbMyFDZCXBPbpA5GBJg++eLXgG2frsP          KX4g==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;         h=references:in-reply-to:message-id:date:subject:cc:to:from          :dkim-signature:dmarc-filter:delivered-to;         bh=9ucWxJ6q9SaBb2GtuoCWauKcHmhMhNM9AVCq4M27NX8=;         b=WpUZQTClzRXcDla249rjaMRB+59tOh1GUmGAM8kgL8WnCbna81asvGU6Jo/bbq83Cs          Sqo4v1LUl1II9mx13DGpJ5aV6ioRCPY7vvZkR1HLrDktlnBB438xlyplcDvfKM85VqGu          PKXzFGmfRfdJOG9yIRRrB5zSJsxhBmLac3VWCD0kF9n0e2pw5l2SnkqOhX8XoJBxQnof          Qqdet9wR1KV0cZ1jtZtcTAVC6L5y0pBbKsOugONttn40r7ttjW6GGZgjDqDqA5wVduf4          PHD+Zvrrx3HOdFd578HYU8/iE+vtFtQr7QUZ02qj6G5bwwjkgsuykSIhR4Qog4YB7yem          eJMA==
ARC-Authentication-Results: i=1; mx.google.com;        dkim=pass header.i=@gmail.com header.s=20161025 header.b=TOsdq0zE;        spf=pass (google.com: domain of srs0=et05=ul=gmail.com=tiny.windzz@kernel.org designates 198.145.29.99 as permitted sender) smtp.mailfrom="SRS0=eT05=UL=gmail.com=tiny.windzz@kernel.org";        dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
Return-Path: <SRS0=eT05=UL=gmail.com=tiny.windzz@kernel.org>
Received: from mail.kernel.org (mail.kernel.org. [198.145.29.99])         by mx.google.com with ESMTPS id v184si239547pgb.86.2019.06.12.09.28.34         for <viresh.kumar@linaro.org>         (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);         Wed, 12 Jun 2019 09:28:34 -0700 (PDT)
Received-SPF: pass (google.com: domain of srs0=et05=ul=gmail.com=tiny.windzz@kernel.org designates 198.145.29.99 as permitted sender) client-ip=198.145.29.99;
Authentication-Results: mx.google.com;        dkim=pass header.i=@gmail.com header.s=20161025 header.b=TOsdq0zE;        spf=pass (google.com: domain of srs0=et05=ul=gmail.com=tiny.windzz@kernel.org designates 198.145.29.99 as permitted sender) smtp.mailfrom="SRS0=eT05=UL=gmail.com=tiny.windzz@kernel.org";        dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
Received: by mail.kernel.org (Postfix) 	id D9BB0215EA; Wed, 12 Jun 2019 16:28:33 +0000 (UTC)
Delivered-To: vireshk@kernel.org
Received: from mail-pf1-f193.google.com (mail-pf1-f193.google.com [209.85.210.193]) 	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits)) 	(No client certificate requested) 	by mail.kernel.org (Postfix) with ESMTPS id B511121019; 	Wed, 12 Jun 2019 16:28:33 +0000 (UTC)
Authentication-Results: mail.kernel.org; 	dkim=pass (2048-bit key) header.d=gmail.com header.i=@gmail.com header.b="TOsdq0zE"
DMARC-Filter: OpenDMARC Filter v1.3.2 mail.kernel.org B511121019
Authentication-Results: mail.kernel.org; dmarc=pass (p=none dis=none) header.from=gmail.com
Authentication-Results: mail.kernel.org; spf=pass smtp.mailfrom=tiny.windzz@gmail.com
Received: by mail-pf1-f193.google.com with SMTP id i189so9954485pfg.10;         Wed, 12 Jun 2019 09:28:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=gmail.com; s=20161025;         h=from:to:cc:subject:date:message-id:in-reply-to:references;         bh=9ucWxJ6q9SaBb2GtuoCWauKcHmhMhNM9AVCq4M27NX8=;         b=TOsdq0zEKlm1ovsLqsofSlAHa6P17YnxyTYaU0SrWx35AJQLEaLkF0+3Vu7rnet7kS          QxkXWuUBzC5I9Ox8e5luKErNSTypQjGJ2Q1wWrmjeitE7qA8Jvi71xrtaEX1rh4Qwc+Y          h3wSFAIKRAqmDhfys8Bm9Yu9mIrnwNwBvtrZcam657nib4HkVXSKKjfVlbGt3aFtYFGJ          MyXlAAGV88Qyq+89N2CFLXgheOeSe6fDhHox3L8iSsiYAy77Lx7pUWaFRD3RCZ0tarbX          Dxl6n6xUNhXMgoht0Lghj/t1sfKCR8htND5N8NfMAgKGBNPavYBTzy3lGAZJvT27clHh          ugtw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=1e100.net; s=20161025;         h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to          :references;         bh=9ucWxJ6q9SaBb2GtuoCWauKcHmhMhNM9AVCq4M27NX8=;         b=mHnEFuWmDFRl3m10Hzo7QHuEsE7RiQL1cz0xBP63wjF1JHSIwH1ntmjQo1mdkOUHkd          gBv+uFjf5kWKrnyXZ5QFxLas6BfDfBC8ko6WO/VWsz/NLHZ29Y66945Gj3BX3BauT5MO          MQ9W/QiDvwPjVm0/VruwHpKKiHjgGGkzXhaX6eaITjW/5QNndd6BhObHWe9fWp5MCsEg          bx90ICMFDdyqXq/Bgd3yw2Jqr9oYQ2v2OmWn630qfXyhtpkaOllowKvNbawOwBGsJIhm          AATp17aofCjvxKzq2Gfa0xb2/JkzJ+UmmtqAVQwGjtFIoI0gZeZMnNmwlGtp0h/uhMQR          SiOw==
X-Gm-Message-State: APjAAAXEUbOiM3IXb0tofgIDF0XVmi4w3j5Xbz8Lq4tLGuAqL0NEG6jN 	EFE+0WhkMzlz941nDPkrPswMew3HQFM=
X-Received: by 2002:a63:610d:: with SMTP id v13mr25531305pgb.341.1560356912884;         Wed, 12 Jun 2019 09:28:32 -0700 (PDT)
Received: from localhost (68.168.130.77.16clouds.com. [68.168.130.77])         by smtp.gmail.com with ESMTPSA id 201sm70299pfz.24.2019.06.12.09.28.32         (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);         Wed, 12 Jun 2019 09:28:32 -0700 (PDT)
From: Yangtao Li <tiny.windzz@gmail.com>
To: vireshk@kernel.org, 	nm@ti.com, 	sboyd@kernel.org, 	robh+dt@kernel.org, 	mark.rutland@arm.com, 	maxime.ripard@bootlin.com, 	wens@csie.org, 	rjw@rjwysocki.net, 	davem@davemloft.net, 	mchehab+samsung@kernel.org, 	gregkh@linuxfoundation.org, 	linus.walleij@linaro.org, 	nicolas.ferre@microchip.com, 	paulmck@linux.ibm.com
Cc: linux-pm@vger.kernel.org, 	devicetree@vger.kernel.org, 	linux-arm-kernel@lists.infradead.org, 	linux-kernel@vger.kernel.org, 	Yangtao Li <tiny.windzz@gmail.com>
Subject: [RESEND, PATCH v4 2/2] dt-bindings: cpufreq: Document allwinner,sun50i-h6-operating-points
Date: Wed, 12 Jun 2019 12:28:16 -0400
Message-Id: <20190612162816.31713-3-tiny.windzz@gmail.com>
X-Mailer: git-send-email 2.17.0
In-Reply-To: <20190612162816.31713-1-tiny.windzz@gmail.com>
References: <20190612162816.31713-1-tiny.windzz@gmail.com>
Status: RO
Content-Length: 6901
Lines: 199

Allwinner Process Voltage Scaling Tables defines the voltage and
frequency value based on the speedbin blown in the efuse combination.
The sunxi-cpufreq-nvmem driver reads the efuse value from the SoC to
provide the OPP framework with required information.
This is used to determine the voltage and frequency value for each
OPP of operating-points-v2 table when it is parsed by the OPP framework.

The "allwinner,sun50i-h6-operating-points" DT extends the
"operating-points-v2"
with following parameters:
- nvmem-cells (NVMEM area containig the speedbin information)
- opp-microvolt-<name>: voltage in micro Volts.
  At runtime, the platform can pick a <name> and matching
  opp-microvolt-<name> property.
                        HW:             <name>:
                        sun50i-h6      speed0 speed1 speed2

Signed-off-by: Yangtao Li <tiny.windzz@gmail.com>
Acked-by: Maxime Ripard <maxime.ripard@bootlin.com>
---
 .../bindings/opp/sun50i-nvmem-cpufreq.txt     | 167 ++++++++++++++++++
 1 file changed, 167 insertions(+)
 create mode 100644 Documentation/devicetree/bindings/opp/sun50i-nvmem-cpufreq.txt

diff --git a/Documentation/devicetree/bindings/opp/sun50i-nvmem-cpufreq.txt b/Documentation/devicetree/bindings/opp/sun50i-nvmem-cpufreq.txt
new file mode 100644
index 000000000000..7deae57a587b
--- /dev/null
+++ b/Documentation/devicetree/bindings/opp/sun50i-nvmem-cpufreq.txt
@@ -0,0 +1,167 @@
+Allwinner Technologies, Inc. NVMEM CPUFreq and OPP bindings
+===================================
+
+For some SoCs, the CPU frequency subset and voltage value of each OPP
+varies based on the silicon variant in use. Allwinner Process Voltage
+Scaling Tables defines the voltage and frequency value based on the
+speedbin blown in the efuse combination. The sun50i-cpufreq-nvmem driver
+reads the efuse value from the SoC to provide the OPP framework with
+required information.
+
+Required properties:
+--------------------
+In 'cpus' nodes:
+- operating-points-v2: Phandle to the operating-points-v2 table to use.
+
+In 'operating-points-v2' table:
+- compatible: Should be
+	- 'allwinner,sun50i-h6-operating-points'.
+- nvmem-cells: A phandle pointing to a nvmem-cells node representing the
+		efuse registers that has information about the speedbin
+		that is used to select the right frequency/voltage value
+		pair. Please refer the for nvmem-cells bindings
+		Documentation/devicetree/bindings/nvmem/nvmem.txt and
+		also examples below.
+
+In every OPP node:
+- opp-microvolt-<name>: Voltage in micro Volts.
+			At runtime, the platform can pick a <name> and
+			matching opp-microvolt-<name> property.
+			[See: opp.txt]
+			HW:		<name>:
+			sun50i-h6	speed0 speed1 speed2
+
+Example 1:
+---------
+
+	cpus {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		cpu0: cpu@0 {
+			compatible = "arm,cortex-a53";
+			device_type = "cpu";
+			reg = <0>;
+			enable-method = "psci";
+			clocks = <&ccu CLK_CPUX>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			operating-points-v2 = <&cpu_opp_table>;
+			#cooling-cells = <2>;
+		};
+
+		cpu1: cpu@1 {
+			compatible = "arm,cortex-a53";
+			device_type = "cpu";
+			reg = <1>;
+			enable-method = "psci";
+			clocks = <&ccu CLK_CPUX>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			operating-points-v2 = <&cpu_opp_table>;
+			#cooling-cells = <2>;
+		};
+
+		cpu2: cpu@2 {
+			compatible = "arm,cortex-a53";
+			device_type = "cpu";
+			reg = <2>;
+			enable-method = "psci";
+			clocks = <&ccu CLK_CPUX>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			operating-points-v2 = <&cpu_opp_table>;
+			#cooling-cells = <2>;
+		};
+
+		cpu3: cpu@3 {
+			compatible = "arm,cortex-a53";
+			device_type = "cpu";
+			reg = <3>;
+			enable-method = "psci";
+			clocks = <&ccu CLK_CPUX>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			operating-points-v2 = <&cpu_opp_table>;
+			#cooling-cells = <2>;
+		};
+        };
+
+        cpu_opp_table: opp_table {
+                compatible = "allwinner,sun50i-h6-operating-points";
+                nvmem-cells = <&speedbin_efuse>;
+                opp-shared;
+
+                opp@480000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <480000000>;
+
+                        opp-microvolt-speed0 = <880000>;
+                        opp-microvolt-speed1 = <820000>;
+                        opp-microvolt-speed2 = <800000>;
+                };
+
+                opp@720000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <720000000>;
+
+                        opp-microvolt-speed0 = <880000>;
+                        opp-microvolt-speed1 = <820000>;
+                        opp-microvolt-speed2 = <800000>;
+                };
+
+                opp@816000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <816000000>;
+
+                        opp-microvolt-speed0 = <880000>;
+                        opp-microvolt-speed1 = <820000>;
+                        opp-microvolt-speed2 = <800000>;
+                };
+
+                opp@888000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <888000000>;
+
+                        opp-microvolt-speed0 = <940000>;
+                        opp-microvolt-speed1 = <820000>;
+                        opp-microvolt-speed2 = <800000>;
+                };
+
+                opp@1080000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <1080000000>;
+
+                        opp-microvolt-speed0 = <1060000>;
+                        opp-microvolt-speed1 = <880000>;
+                        opp-microvolt-speed2 = <840000>;
+                };
+
+                opp@1320000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <1320000000>;
+
+                        opp-microvolt-speed0 = <1160000>;
+                        opp-microvolt-speed1 = <940000>;
+                        opp-microvolt-speed2 = <900000>;
+                };
+
+                opp@1488000000 {
+                        clock-latency-ns = <244144>; /* 8 32k periods */
+                        opp-hz = /bits/ 64 <1488000000>;
+
+                        opp-microvolt-speed0 = <1160000>;
+                        opp-microvolt-speed1 = <1000000>;
+                        opp-microvolt-speed2 = <960000>;
+                };
+        };
+....
+soc {
+....
+	sid: sid@3006000 {
+		compatible = "allwinner,sun50i-h6-sid";
+		reg = <0x03006000 0x400>;
+		#address-cells = <1>;
+		#size-cells = <1>;
+		....
+		speedbin_efuse: speed@1c {
+			reg = <0x1c 4>;
+		};
+        };
+};
-- 
2.17.0

