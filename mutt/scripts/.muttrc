#======================================================#
# Boring details
set realname ="Viresh Kumar"
set from = viresh.kumar@linaro.org
set use_from = yes
set envelope_from ="yes"
set sendmail="/usr/bin/msmtp"

# If not set in environment variables:
set spoolfile =/home/vireshk/work/mail/me
#set spoolfile =/var/mail/viresh

source ~/.gpgrc

#======================================================#
# Folders
set folder="~/work/mail"	# Mailboxes in here
set record="+sent"		# where to store sent messages
set postponed="+draft"	# where to store draft messages
set move=no			# Don't move mail from the spool.

#======================================================#
# Watch these mailboxes for new mail:

# mailboxes ! +sent
mailboxes +me +inbox +sent +draft \
	"=-linux-" +linux/gpio +linux/korg +linux/lwn +linux/pm +linux/virtio \
	"=-linaro-" +linaro/android +linaro/announce +linaro/build +linaro/conf +linaro/dev \
	+linaro/discuss +linaro/eas +linaro/everyone +linaro/gitlab +linaro/kernel \
	+linaro/kernelci +linaro/lng +linaro/moderator +linaro/payslip +linaro/pmwg \
	+linaro/releases +linaro/schedtools +linaro/switchers +linaro/tech +linaro/toolchain +linaro/wiki \
	"=-ara-" +ara/greybus +ara/list +ara/jira \
	"=-bkp-" +bkp/me-bkp-jan16
#mailboxes ! +Fetchmail +slrn +mutt
set sort_browser=alpha		# Sort mailboxes by alpha(bet)

# ============================== #
# Tricks
set sleep_time=0
#set header_cache=~/scripts/mutt/cache/headers # where to store the headers
#set message_cachedir=~/scripts/mutt/cache/bodies # where to store the bodies

#======================================================#
# Order of headers and what to show
hdr_order Date: From: User-Agent: X-Mailer \
	To: Cc: Reply-To: Subject:
ignore *
unignore Date: From: User-Agent: X-Mailer \
	 To: Cc: Reply-To: Subject:

#======================================================#
# which editor do you want to use?
# vim of course!
#set editor="vim"
set editor="vim -c 'set spell tw=80 et' '+/^$' "
set edit_headers		# See the headers when editing

## Use a signature
set signature="~/.signature"

#======================================================#
# Aliases

set sort_alias=alias		# sort aliases in alpha order by alias name

#======================================================#
# Odds and ends
set markers		# mark wrapped lines of text in the pager with a +
set smart_wrap		# Don't wrap mid-word
set pager_context=5	# Retain 5 lines of previous page when scrolling.
set status_on_top	# Status bar on top.
push <show-version>	# Shows mutt version at startup

#======================================================#
# Macros
macro index,pager I '<shell-escape> fetchmail <enter>'
#macro index,pager I '<shell-escape> fetchmail -k <enter>'
macro index \|	'<collapse-all>'
macro index \\	'<collapse-thread>'

# Labels to mark messages pen,apply
macro index ",1" "<enter-command>set editor=\"~/scripts/editlabel append "pen"\"\n\
<edit><sync-mailbox><next-undeleted>\
<enter-command>set editor=vim\n"

bind index . noop
macro index ".1" "<enter-command>set editor=\"~/scripts/editlabel remove "pen"\"\n\
<edit><sync-mailbox><next-undeleted>\
<enter-command>set editor=vim\n"

macro index ",2" "<enter-command>set editor=\"~/scripts/editlabel append "apply"\"\n\
<edit><sync-mailbox><next-undeleted>\
<enter-command>set editor=vim\n"

macro index ".2" "<enter-command>set editor=\"~/scripts/editlabel remove "apply"\"\n\
<edit><sync-mailbox><next-undeleted>\
<enter-command>set editor=vim\n" "test"

macro index,pager ",0" "<enter-command>set editor=\"vim -c 'set spell tw=70 et' '+/^$'"\n

# ctrl+y: show pending, ctrl+a: show all
macro index \Cy "<limit>~y pen|~y apply\n" "Limit view to label"
macro index \Ca "<limit>all\n<collapse-all>" "Limit view to label"


#-----------------------------------------#
# Save patches

#macro index (t '<tag-entry>~/scripts/mutt/scripts/mail-to-mbox^M'  "Dumps tagged patches into ~/scripts/mutt/incoming/*.mbox"
#macro index (a '<tag-entry>~/scripts/mutt/scripts/git-apply-incoming^M'  "git am ~/scripts/mutt/incoming/*.mbox"
#macro index (g '<tag-entry>~/scripts/mutt/scripts/git-apply^M'  "git am tagged patches"
#macro index ,t '<pipe-entry>~/scripts/mutt/scripts/mail-to-mbox^M'  "Dumps currently viewed patch into ~/scripts/mutt/incoming/*.mbox"
#macro index ,g '<pipe-entry>~/scripts/mutt/scripts/git-apply^M' "git am currently viewed patch"
#macro index ,r '<pipe-entry>~/scripts/mutt/scripts/clean^M' "git-reset --hard origin"

macro index,pager \Ch '<pipe-entry>~/scripts/mutt/scripts/frommutt^M' "output git patches"
macro index,pager ,r '<pipe-entry>rm -f ~/scripts/mutt/incoming/*.mbox^M'  "Nukes all ~/scripts/mutt/incoming/" 
macro index,pager ,l '<pipe-entry>ls -ltr ~/scripts/mutt/incoming/^M'  "ls -l ~/scripts/mutt/incoming/"         
macro index,pager ,a '<pipe-entry>~/scripts/mutt/scripts/git-apply-incoming^M' "Apply all patches"
macro index A '<pipe-entry> git am -s'\n


#======================================================#
# Colors
 color normal	 black default
# color normal	 white default
color attachment yellow default
color hdrdefault cyan default
color indicator black cyan
color markers	brightred default
color quoted	green default
color signature cyan default
color status	brightgreen default
color tilde	blue default
color tree	red default
#color body	brightred black [\-\.+_a-zA-Z0-9]+@[\-\.a-zA-Z0-9]+
#color body	brightblue black (https?|ftp)://[\-\.,/%~_:?&=\#a-zA-Z0-9]+

color index	yellow	default		"~P"		# From me
color index	blue	default		"~N"		# new messages
color index	blue	default		"~O"		# old messages
color index	blue	default		"~U"		# unread messages
color index	blue	default		"~v~(~N|~O)"	# collapsed thread with some unread
color index	red	default		"~D(!~p|~p)"	# deleted

# for reading patches
color header	red	default ^From:
color header	yellow	default ^To:
color header	cyan	default ^Reply-To:
color header	yellow	default ^Cc:
color header	blue	default ^Subject:

color body red		default "^-.*"
color body green	default "^[+].*"
color body green	default "^>.*"
color body red		default "^> ?>.*"
color body cyan		default "^> ?> ?>.*"
color body blue		default "^> ?> ?> ?>.*"
color body yellow	default "^> ?> ?> ?> ?>.*"
color body cyan		default "^diff --git.*"
color body cyan		default "^index [a-f0-9].*"

# for highlighting hyperlinks
color body brightred default "http://.*"
color body brightred default "https://.*"
color body brightred default "ftp://.*"


#======================================================#
# Looks
set date_format="!%d-%m-%y, %H:%M"
set index_format="%Z %d %-25.25n (%M) %?y?[%.20Y] ?%s"
# set index_format="%4C %Z %d %-25.25n (%M) %?y?[%.20Y] ?%s"

folder-hook . "exec collapse-all"
set sort=threads
set sort_aux=last-date-received
unset mark_old
set menu_scroll          # scroll menu a page on last line
set pager_stop           # don't go to next message at end of message

#======================================================#
# Sidebar
color sidebar_unread blue default 
set sidebar_width=18
set sidebar_visible=yes
#set sidebar_delim='|'
#set sidebar_sort=no
set sidebar_short_path=yes
set sidebar_folder_indent=yes

# ctrl-n, ctrl-p to select next, prev folder # ctrl-o to open selected folder
bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open

macro index z '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager z '<enter-command>toggle sidebar_visible<enter><redraw-screen>'

#=======================================================#
# Shortcuts
bind pager <space> next-page
bind pager <up> previous-line
bind pager <down> next-line
bind pager <left> exit
bind pager <right> view-attachments
#bind pager <esc> exit
bind attach <left> exit
bind attach <right> view-attach
bind index <right> display-message
bind index <left> display-message
bind browser <right> select-entry
bind browser <left> exit

#======================================================#
# Sending mails
my_hdr Bcc: Viresh Kumar <viresh.kumar@linaro.org>
set autoedit
set include
set beep_new             # beep on new message
#macro index     ",s"    "<pipe-message>(formail -rkt; cat /home/vireshk/mutt/template/ack.tmpl) |vim<enter>"

#======================================================#
#auto_view text/html
set mailcap_path = ~/.mutt_mailcap

#======================================================#
# Contacts
set query_command="goobook query '%s'"
bind editor <Tab> complete-query
macro index,pager a "<pipe-message>goobook add<return>" "add the sender address to Google contacts"

#====================3
# Backup
#
# text/html;                      lynx %s; nametemplate=%s.html
# text/html;                      lynx -dump %s; nametemplate=%s.html; copiousoutput

# PGP
set pgp_encrypt_only_command="/usr/lib/neomutt/pgpewrap gpg --batch --quiet --no-verbose --output - --textmode --armor -- --recipient %r -- --encrypt %f"
set pgp_sign_as=D2B91C3CAE81121C
#set pgp_check_gpg_decrypt_status_fd = no
